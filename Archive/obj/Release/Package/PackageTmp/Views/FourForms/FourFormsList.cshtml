@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>

    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <link href="~/Resource/plugins/radio/css/jquery-labelauty.css" rel="stylesheet" />
    <script src="~/Resource/plugins/radio/js/jquery-labelauty.js"></script>
    <script src="~/Resource/plugins/spin.min.js/spin.min.js"></script>
    <style>
        li {
            list-style: none;
        }

        .labelauty-checked, .labelauty-unchecked {
            font-size: 12px !important;
        }

        .dowebok li label {
            padding: 7px 10px !important;
        }
    </style>
</head>
<body>
    <div class="mySearch">
        <div class="row">
            <div class="col-xs-1">
                <label class="margin-5">姓名：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" type="text" name="PersonName" id="qry_PersonName" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label class="margin-5">所在单位：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonUnit" id="qry_PersonUnit">
            </div>
            <div class="col-xs-1">
                <label class="margin-5">职级：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonDuty" id="qry_PersonDuty">
            </div>
            <div class="col-xs-1">
                <label>数据补全：</label>
            </div>
            <div class="col-xs-2">
                <select id="buquan" class="form-control selectpicker">
                    <option value=""></option>
                    <option value="未完善信息">未完善信息</option>
                    <option value="未关联干部">未关联干部</option>
                    <option value="未上传附件">未上传附件</option>
                    <option value="已上传附件">已上传附件</option>
                </select>
            </div>
        </div>
        <div class="row margin-top-10">
            <div class="col-xs-1">
                <label class="margin-5">违纪行为：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonUnit" id="qry_IllegalBehavior">
            </div>
            <div class="col-xs-1">
                <label class="margin-5">涉法行为：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonDuty" id="qry_LawBehaviour">
            </div>
            <div class="col-xs-1">
                <label class="margin-5">受理时间：</label>
            </div>
            <div class="col-xs-5">
               <input autocomplete = "off" placeholder="起止日期" class="form-control layer-date" style="width:100% !important;display:inline-block" id="ins1">
            </div>
        </div>
        <div class="row margin-top-10">
            <div class="col-xs-6">
            
                <div class="inline-b" style=" margin:0px 10px 10px 10px;position:relative;float:left;width:80px">
                   <input autocomplete = "off" id="file_upload" name="file_upload" type="file" multiple="true" />
                </div>
                <div class="inline-b" style="position: relative; float: left; margin-left: 20px; margin: 0px 0px 0px 10px;">
                    <a class="layui-btn" id="btnUpload" data-options="iconCls:'icon-save'" href="javascript:checkQueue()">导入</a>
                    <a class="layui-btn layui-btn-primary" id="btnCancelUpload" data-options="iconCls:'icon-cancel'" href="javascript:checkCancel()">取消</a>
                </div>
                <div id="queue" style="margin-top: 0px 0px 0px 10px; width: 60%; position: relative; display: inline-block; float: left; margin-left: 20px;"></div>
            </div>
            <div class="col-xs-6" style="text-align:right">
                <button type="button" class="layui-btn" onclick="Create()"><i class="layui-icon"></i></button>

                <button class="layui-btn layuiadmin-btn-list" onclick="queryDataGrid()">
                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                </button>
                <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="mySearchClear()">
                    <i class="layui-icon layui-icon-refresh-1 layuiadmin-button-btn"></i>
                </button>
            </div>
        </div>
    </div>

    <div>
        <table id="FourFormsList_table" class="table table-striped table-no-bordered table-hover" ></table>
    </div>
    <div id="pageNamber1" style="position:absolute;bottom:14px;text-align:center;right:300px;display:none">
        <label style="font-weight:500">跳转到</label>
       <input autocomplete = "off" value="1" id="pageNamber" class="form-control" style="width:40px;text-align:center;height:30px;display:inline-block" />
        <label style="font-weight:500">页</label>
    </div>
    @RenderPage("~/Views/Share/delConfirm.cshtml")
    <div id="myMasks">
        <div id="ai" style="position: relative; border-radius: 10px; width: 250px; height: 100px; margin-left: auto; margin-right: auto; margin-top: 10px; background-color: rgba(0,0,0,0.4); padding: 20px; }">
            <div id="foo" style="float: left; width: auto; height: auto; margin-top: 12px; margin-top: 28px; margin-left: 25px; "></div>
            <label id="myMasksText" style="color: #fff; font-size: 18px; float: left; margin-left: 40px;  margin-top: 15px; ">正在导入，请稍等</label>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    Date.prototype.Format = function (fmt) { //author: meizz

        var o = {
            "M+": this.getMonth() + 1, //月份 
            "d+": this.getDate(), //日 
            "h+": this.getHours(), //小时 
            "m+": this.getMinutes(), //分 
            "s+": this.getSeconds(), //秒 
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
            "S": this.getMilliseconds() //毫秒 
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }
    var SearchHeight = $(".mySearch").height();
   // console.log(SearchHeight);
    $('#FourFormsList_table').bootstrapTable({
        height: $(window).height() - SearchHeight-25,
        url: '/FourForms/GetFourFormsList',
        method: 'get',
        toolbar: '#toolbar',    //工具按钮用哪个容器
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,     //是否显示分页（*）
        sortable: true,      //是否启用排序
        sortName: "AcceptTime",
        sortOrder: "desc",
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 100,      //每页的记录行数（*）
        pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
        strictSearch: true,
        minimumCountColumns: 2,    //最少允许的列数
        clickToSelect: true,    //是否启用点击选中行
        queryParams: function (params) {
            return {
                sort: params.sortName,     //排序方式
                order: params.sortOrder,
                //keyword1: $("input[type=checkbox]:checked").length <= 0 ? "" : $("input[type=checkbox]:checked").val(),
                keyword2: $('#qry_PersonName').val(),
                keyword3: $('#qry_PersonUnit').val(),
                keyword4: $('#qry_PersonDuty').val(),
                keyword5: $('#qry_IllegalBehavior').val(),
                keyword6: $('#qry_LawBehaviour').val(),
                keyword7: $('#start').val(),
                keyword8: $("#end").val(),
                buquan: $("#buquan").val(),
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
            }
        },
        columns: [
            { field: 'AcceptTime', title: '受理时间', width: 50, editable: false, formatter: IfEmpty, sortable: true  },
            { field: 'PersonName', title: '姓名', width: 50, editable: false, formatter: IfEmpty, sortable: true  },
            { field: 'PersonUnit', title: '工作单位及职务', width: 100, editable: false, formatter: IfEmpty, sortable: true  },
            { field: 'PersonLevel', title: '职级', width: 50, editable: false, formatter: IfEmpty, sortable: true  },
            { field: 'HandleTime', title: '处置时间', width: 100, editable: false, formatter: IfEmpty2 },
            { field: 'HandleType', title: '处置方式', width: 100, editable: false, formatter: IfEmpty },

            { field: 'opt', title: '操作', width: 100, editable: false, formatter: operateFormatterFourForms },
        ],
    });
    $('table').on('load-success.bs.table', function (data) {
       // console.log("load success");
        $("[data-toggle='tooltip']").tooltip();
        var a = $('table').bootstrapTable('getData');
        //console.log(a);
        if (a.length > 0) {
            $("#pageNamber1").css("display", "block");
        }
    });
    function IfEmpty2(value, row, index) {
        var a = "";
        var oldTime = Date.parse(new Date(row.AcceptTime));
        var nowTime = Date.parse(new Date());
        var xiangcha = Math.abs(parseInt((nowTime - oldTime) / 1000 / 3600 / 24));
        if (xiangcha >= 30 && (value == null || value == "")) {
            a = '<span style="width:100%;height:100%;padding:5px" data-toggle="tooltip" data-placement="right" title="已受理' + xiangcha + '天仍未处置" ><i class="glyphicon glyphicon-question-sign" style="color:#d46c6c;font-size: 16px;"></i></span>';
        } else {
            a = value;
        }
        return a;
    }
    function operateFormatterFourForms(value, row, index) {
        return [
            '<button  onclick="LayerModal(\'编辑\',\'/FourForms/Edit?ID=' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn  layui-btn-sm" style="margin-right:10px">编辑</button>',
            '<a  href="javascript:deleteByID(\'' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="margin-right:10px">删除</a>',
        ].join('');
    }
    $(function () {
        //$('input[type=checkbox]').labelauty();
    });
    function queryDataGrid() {
        $('#FourFormsList_table').bootstrapTable('refresh', {
            pageNumber: 1,
        });
    }
    function myClear() {
        $('#qry_PersonName').val("");
        $('#qry_PersonUnit').val("");
        $('#qry_PersonDuty').val(""),
        $('#qry_IllegalBehavior').val(""),
        $('#qry_LawBehaviour').val(""),
        $('#start').val("");
        $('#end').val("");
        $('#ins1').val("");
        $('#IsEmpty').val("");
        queryDataGrid();
    };
    function Create() {
        LayerModal("新增","/FourForms/FourFormsCreate");
    }

    function checkQueue() {
        if ($("#queue").children().length == 0) {
            alert("请先点击浏览选择要上传的文件！");
        } else {
            loading();
            $('#file_upload').uploadifive('upload');
        }
    }
    function checkCancel() {
        if ($("#queue").children().length == 0) {
            alert("没有待上传的文件！");
        } else {
            $('#file_upload').uploadifive('clearQueue');
            queryDataGrid();
        }
    }

    $(function () {
        var a = 0;
        $('#file_upload').uploadifive({
            'auto': false,
            'fileSizeLimit': '10000KB',
            'buttonText': '浏  览',
            'multi': true,
            'queueID': 'queue',
            'uploadScript': '/FourForms/FourFormsUpload',
            'formData': { 'ID': '@*@item.ID*@', 'type': 'FourForms' },
            'onUploadComplete': function (file, data) {
                a = a + 1;
                if ($("#queue").children().length - a == 0) {
                    checkCancel();
                    a = 0;
                };
                unload();
            }
        });
        $("#pageNamber").change(function () {
            $('table').bootstrapTable('refresh', {
                pageNumber: $("#pageNamber").val(),
            });
        })
    });

    function deleteByID(id) {
        $('#id').val(id);//给会话中的隐藏属性URL赋值
        $('#idName').val("ID");
        $('#backMsg').val("FourFormsList_table");
        $('#urlDel').val("/FourForms/Delete");
        $('#urlBack').val("/FourForms/GetFourFormsList");
        $('#delcfmModel').modal();
    }

    var spinner;
    function loading() {
        $("#myMasksText").html("正在导入，请稍等");
        $("#myMasks").fadeIn(300);
        var height = $(window).height() + "px";
        $("#myMasks").height($(window).height());
        //
        $("#ai").css("top", $(window).height() / 2 - 100);
        var opts = {
            lines: 13, //The number of lines to draw   菊花瓣的数目
            length: 7, //The length of each line   菊花瓣的长度
            width: 4, //The line thickness   菊花瓣的宽度
            radius: 10, //The radius of the inner circle   菊花中心的半径
            corners: 1, //Corner roundness (0..1)   菊花瓣的圆滑度(0--1)
            rotate: 0, //The rotation offset   让菊花旋转的角度
            color: '#fff', //#rgb or #rrggbb   菊花的颜色
            speed: 1, //Rounds per second   菊花旋转的速度
            trail: 60, //Afterglow percentage   菊花旋转时的余辉
            shadow: false, //Whether to render a shadow   是否需要菊花的阴影
            hwaccel: false, //Whether to use hardware acceleration   是否需要菊花高速旋转(硬件加速)
            className: 'spinner', //The CSS class to assign to the spinner   菊花的classname
            zIndex: 2e9, //The z-index (defaults to 2000000000)   菊花的z-index值
            top: 'auto', //Top position relative to parent in px   菊花相对定位的top
            left: 'auto' //Left position relative to parent in px  菊花相对定位的left
        };
        var target = document.getElementById('foo');
        spinner = new Spinner(opts).spin(target);
    }
    function unload() {
        spinner.stop();
        $("#myMasksText").html("导入成功");
        setTimeout(function () {
            $("#myMasks").fadeOut(300);
        }, 500);
    }

</script>