@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>

    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <link href="~/Resource/plugins/radio/css/jquery-labelauty.css" rel="stylesheet" />
    <script src="~/Resource/plugins/radio/js/jquery-labelauty.js"></script>
    <style>
        li {
            list-style: none;
        }

        .labelauty-checked, .labelauty-unchecked {
            font-size: 12px !important;
        }

        .dowebok li label {
            padding: 7px 10px !important;
        }
    </style>
</head>
<body>
    <div class="mySearch">
        <div class="row">
            <div class="col-xs-1">
                <label class="">姓名：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="text" name="PersonName" id="qry_PersonName" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label>单位职务：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="text" name="PersonUnit" id="qry_PersonUnit" class="form-control" />
            </div>

            <div class="col-xs-1">
                <label>党纪处分：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="text" name="PartyPunish" id="qry_PartyPunish" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label>政纪处分：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="text" name="GovenPunish" id="qry_GovenPunish" class="form-control" />
            </div>
        </div>
        <div class="row margin-top-10">
            <div class="col-xs-1">
                <label class="">立案时间：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" placeholder="起止日期" class="form-control layer-date" style="width:100% !important;display:inline-block" id="ins1">
            </div>
            <div class="col-xs-1">
                <label class="">结案时间：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="hidden" id="start2" />
                <input autocomplete = "off" type="hidden" id="end2" />
                <input autocomplete = "off" placeholder="起止日期" class="form-control layer-date" style="width:100% !important;display:inline-block" id="ins2">
            </div>
            <div class="col-xs-1">
                <label>职级：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="text" name="PersonLevel" id="qry_PersonLevel" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label>数据补全：</label>
            </div>
            <div class="col-xs-2">
                <select id="buquan" class="form-control selectpicker">
                    <option value=""></option>
                    <option value="无立案决定书">无立案决定书</option>
                    <option value="有立案决定书">有立案决定书</option>
                    <option value="未完善信息">未完善信息</option>
                    <option value="逾期未结案">逾期未结案</option>
                    <option value="逾期未解除政纪处分">逾期未解除政纪处分</option>
                    <option value="无处分决定文件">无处分决定文件</option>
                    <option value="有处分决定文件">有处分决定文件</option>
                    <option value="无解除政纪决定文件">无解除政纪决定文件</option>
                    <option value="有解除政纪决定文件">有解除政纪决定文件</option>

                </select>
            </div>
        </div>
        <div class="row margin-top-10">

            <div class="col-xs-1">
                <label>立案机关：</label>
            </div>
            <div class="col-xs-2">
                <input autocomplete = "off" type="text" name="CaseUnit" id="qry_CaseUnit" class="form-control" />
            </div>
            <div class="col-xs-6">

                <div class="inline-b" style=" margin:0px 10px 0px 10px;position:relative;float:left;width:80px">
                    <input autocomplete = "off" id="file_upload" name="file_upload" type="file" multiple="true" />
                </div>
                <div class="inline-b" style="position: relative; float: left; margin-left: 20px; margin: 0px 0px 0px 10px;">
                    <a class="layui-btn" id="btnUpload" data-options="iconCls:'icon-save'" href="javascript:checkQueue()">导入</a>
                    <a class="layui-btn layui-btn-primary" id="btnCancelUpload" data-options="iconCls:'icon-cancel'" href="javascript:checkCancel()">取消</a>
                </div>
                <div id="queue" style="margin-top: 0px 0px 0px 10px; width: 50%; position: relative; display: inline-block; float: left; margin-left: 20px;"></div>
            </div>
            <div class="col-xs-3" style="text-align:right">
                <button type="button" class="layui-btn" onclick="Create()"><i class="layui-icon"></i></button>

                <button class="layui-btn layuiadmin-btn-list" onclick="queryDataGrid()">
                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                </button>
                <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="mySearchClear()">
                    <i class="layui-icon layui-icon-refresh-1 layuiadmin-button-btn"></i>
                </button>
            </div>
        </div>

    </div>


    <div class="margin-top-10">
        <table id="CaseList_table" class="table table-striped table-no-bordered table-hover" ></table>
    </div>
    <div id="pageNamber1" style="position:absolute;bottom:14px;text-align:center;right:300px;display:none">
        <label style="font-weight:500">跳转到</label>
        <input autocomplete = "off" value="1" id="pageNamber" class="form-control" style="width:40px;text-align:center;height:30px;display:inline-block" />
        <label style="font-weight:500">页</label>
    </div>
    @RenderPage("~/Views/Share/delConfirm.cshtml")
    <div id="myMasks">
        <div id="ai" style="position: relative; border-radius: 10px; width: 250px; height: 100px; margin-left: auto; margin-right: auto; margin-top: 10px; background-color: rgba(0,0,0,0.4); padding: 20px; }">
            <div id="foo" style="float: left; width: auto; height: auto; margin-top: 12px; margin-top: 28px; margin-left: 25px; "></div>
            <label id="myMasksText" style="color: #fff; font-size: 18px; float: left; margin-left: 40px;  margin-top: 15px; ">正在导入，请稍等</label>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    var ins2 = laydate.render({
        elem: '#ins2',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期
        range: "~",
        change: function (value, date, endDate) {
            $("#start2").val(value.substring(0, 10));
            $("#end2").val(value.substring(13, 23));
            // console.log($("#end").val());
        },
    });
    var SearchHeight = $(".mySearch").height();
    $('#CaseList_table').bootstrapTable({
        height: $(window).height() - SearchHeight-25,
        url: '/Case/GetCaseInfoList',
        method: 'get',
        toolbar: '#toolbar',    //工具按钮用哪个容器
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,     //是否显示分页（*）
        sortable: true,      //是否启用排序
        sortName: "FilingTime",
        sortOrder: "desc",
        sortOrder: "asc",     //排序方式
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 100,      //每页的记录行数（*）
        pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
        strictSearch: true,
        minimumCountColumns: 2,    //最少允许的列数
        clickToSelect: true,    //是否启用点击选中行
        queryParams: function (params) {
            return {

                sort: params.sortName,     //排序方式
                order: params.sortOrder,
              
                keyword1: $('#qry_PersonName').val(),
                keyword2: $('#qry_PersonUnit').val(),
                keyword3: $('#qry_PersonLevel').val(),
                keyword4: $('#qry_PartyPunish').val(),
                keyword5: $('#qry_GovenPunish').val(),
                keyword6: $('#start').val(),
                keyword7: $('#end').val(),
                keyword10: $('#start2').val(),
                keyword11: $('#end2').val(),
                buquan: $("#buquan").val(),
                keyword12: $("#qry_CaseUnit").val(),
                //keyword8: $("input[type=checkbox]:checked").length <= 0 ? "" : $("input[type=checkbox]:checked").val(),
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
            }
        },
        columns: [
            { field: 'FilingTime', title: '立案时间', width: 50, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'CaseUnit', title: '立案机关', width: 50, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'PersonName', title: '被调查人', width: 50, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'PersonUnit', title: '单位职务', width: 100, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'PersonLevel', title: '职级', width: 50, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'ClosingTime', title: '结案时间', width: 50, editable: false, formatter: IfEmpty2, sortable: true },
            { field: 'CaseSource', title: '案件来源', width: 50, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'PartyandGovenPunish', title: '党纪政纪处分', width: 100, editable: false, formatter: IfEmpty},
            { field: 'opt', title: '操作', width: 90, editable: false, formatter: operateFormatterCaseList },
        ],
    });
    $('table').on('load-success.bs.table', function (data) {
        // console.log("load success");
        $("[data-toggle='tooltip']").tooltip();
        var a = $('table').bootstrapTable('getData');
        //console.log(a);
        if (a.length > 0) {
            $("#pageNamber1").css("display", "block");
        }
    });
    function IfEmpty2(value, row, index) {
        var a = "";
        var oldTime = Date.parse(new Date(row.FilingTime));
        var nowTime = Date.parse(new Date());
        var xiangcha = Math.abs(parseInt((nowTime - oldTime) / 1000 / 3600 / 24));
        if (xiangcha >= 30 && (value == null || value == "")) {
            a = '<span style="width:100%;height:100%;padding:5px" data-toggle="tooltip" data-placement="right" title="已立案' + xiangcha + '天仍未结案" ><i class="glyphicon glyphicon-question-sign" style="color:#d46c6c;font-size: 16px;"></i></span>';
        } else {
            a = value;
        }
        return a;
    }
    function operateFormatterCaseList(value, row, index) {
        return [
            '<button  onclick="LayerModal(\'编辑\',\'/Case/Edit?ID=' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-sm" style="margin-right:10px">编辑</button>',
            '<a  href="javascript:deleteByID(\'' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="margin-right:10px">删除</a>',
        ].join('');
    }
    $(function () {
        //$('input[type=checkbox]').labelauty();
    });
    function queryDataGrid() {
        $('#CaseList_table').bootstrapTable('refresh', {
            pageNumber: 1,
        });
    }
    function myClear() {
        $('#qry_PersonName').val("");
        $('#qry_PersonUnit').val("");
        $('#qry_PersonLevel').val("");
        $('#qry_PartyPunish ').val("");
        $('#qry_GovenPunish').val("");
        $('#start').val("");
        $('#end').val("");
        $('#ins1').val("");
        $('#start2').val("");
        $('#end2').val("");
        $('#ins2').val("");
        $('#IsEmpty').val("");
        $('#qry_CaseUnit').val("");
        queryDataGrid();
    };
    function Create() {
        LayerModal("新增", "/Case/CaseInfoCreate");

    }

    function checkQueue() {
        if ($("#queue").children().length == 0) {
            alert("请先点击浏览选择要上传的文件！");
        } else {
            loading();
            $('#file_upload').uploadifive('upload');
        }
    }
    function checkCancel() {
        if ($("#queue").children().length == 0) {
            alert("没有待上传的文件！");
        } else {
            $('#file_upload').uploadifive('clearQueue');
            queryDataGrid();
        }
    }

    $(function () {
        var a = 0;
        $('#file_upload').uploadifive({
            'auto': false,
            'fileSizeLimit': '10000KB',
            'buttonText': '浏  览',
            'multi': true,
            'queueID': 'queue',
            'uploadScript': '/Case/CaseUpload',
            'formData': { 'ID': '@*@item.ID*@', 'type': 'Case' },
            'onUploadComplete': function (file, data) {
                a = a + 1;
                if ($("#queue").children().length - a == 0) {
                    checkCancel();
                    a = 0;
                }
                unload();
            }
        });
        $("#pageNamber").change(function () {
            $('table').bootstrapTable('refresh', {
                pageNumber: $("#pageNamber").val(),
            });
        })
    });

    function deleteByID(id) {
        $('#id').val(id);//给会话中的隐藏属性URL赋值
        $('#idName').val("ID");
        $('#backMsg').val("CaseList_table");
        $('#urlDel').val("/Case/Delete");
        $('#urlBack').val("/Case/GetCaseInfoList");
        $('#delcfmModel').modal();
    }





    var spinner;
    function loading() {
        $("#myMasksText").html("正在导入，请稍等");
        $("#myMasks").fadeIn(300);
        var height = $(window).height() + "px";
        $("#myMasks").height($(window).height());
        //
        $("#ai").css("top", $(window).height() / 2 - 100);
        var opts = {
            lines: 13, //The number of lines to draw   菊花瓣的数目
            length: 7, //The length of each line   菊花瓣的长度
            width: 4, //The line thickness   菊花瓣的宽度
            radius: 10, //The radius of the inner circle   菊花中心的半径
            corners: 1, //Corner roundness (0..1)   菊花瓣的圆滑度(0--1)
            rotate: 0, //The rotation offset   让菊花旋转的角度
            color: '#fff', //#rgb or #rrggbb   菊花的颜色
            speed: 1, //Rounds per second   菊花旋转的速度
            trail: 60, //Afterglow percentage   菊花旋转时的余辉
            shadow: false, //Whether to render a shadow   是否需要菊花的阴影
            hwaccel: false, //Whether to use hardware acceleration   是否需要菊花高速旋转(硬件加速)
            className: 'spinner', //The CSS class to assign to the spinner   菊花的classname
            zIndex: 2e9, //The z-index (defaults to 2000000000)   菊花的z-index值
            top: 'auto', //Top position relative to parent in px   菊花相对定位的top
            left: 'auto' //Left position relative to parent in px  菊花相对定位的left
        };
        var target = document.getElementById('foo');
        spinner = new Spinner(opts).spin(target);
    }
    function unload() {
        spinner.stop();
        $("#myMasksText").html("导入成功");
        setTimeout(function () {
            $("#myMasks").fadeOut(300);
        }, 500);
    }


</script>
