@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>

    @RenderPage("~/Views/Share/bootstrap.cshtml")

    <link href="~/Resource/plugins/radio/css/jquery-labelauty.css" rel="stylesheet" />
    <script src="~/Resource/plugins/radio/js/jquery-labelauty.js"></script>
    <style>
        li {
            list-style: none;
        }

        .labelauty-checked, .labelauty-unchecked {
            font-size: 12px !important;
        }

        .dowebok li label {
            padding: 7px 10px !important;
        }
    </style>
</head>
<body>
    <div class="mySearch">
        <div class="row">
            <div class="col-xs-1">
                <label class="margin-5">姓名：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" type="text" name="ObjName" id="qry_ObjName" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label class="margin-5">所在单位：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="ObjAddress" id="qry_ObjAddress">
            </div>
            <div class="col-xs-1">
                <label class="margin-5">职级：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" type="text" name="ObjAdminLvl" id="qry_ObjAdminLvl" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label class="margin-5">数据补全：</label>
            </div>
            <div class="col-xs-2">
                <select id="buquan" class="form-control selectpicker">
                    <option value=""></option>
                    <option value="未完善信息">未完善信息</option>
                    <option value="未关联干部">未关联干部</option>
                    <option value="未上传附件">未上传附件</option>
                </select>
            </div>
        </div>
        <div class="row" style="margin-top:10px">
            @*<div class="col-xs-1">
                    <label class="margin-5">线索状态：</label>
                </div>
                <div class="col-xs-2">
                   <input autocomplete = "off" type="text" name="Status" id="qry_Status" class="form-control" />
                </div>
                <div class="col-xs-1">
                    <label class="margin-5">处置方式：</label>
                </div>
                <div class="col-xs-2">
                   <input autocomplete = "off" type="text" name="HandleType" id="qry_HandleType" class="form-control" />
                </div>*@
            <div class="col-xs-1">
                <label class="margin-5">主要问题：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" type="text" name="MainMode" id="qry_MainMode" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label class="margin-5" for="HandleTime">登记时间：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" placeholder="起止日期" class="form-control layer-date" style="width:100% !important;display:inline-block" id="ins1">
            </div>
            <div class="col-xs-6" style="text-align:right">
                <button type="button" class="layui-btn" onclick="Create()"><i class="layui-icon"></i></button>

                <button class="layui-btn layuiadmin-btn-list" onclick="queryDataGrid()">
                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                </button>
                <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="mySearchClear()">
                    <i class="layui-icon layui-icon-refresh-1 layuiadmin-button-btn"></i>
                </button>
            </div>
        </div>

     
        <div style="height:10px;"></div>
    </div>


    <div>
        <table id="ClueList_table" class="table table-striped table-no-bordered table-hover" ></table>
    </div>
    <div id="pageNamber1" style="position:absolute;bottom:14px;text-align:center;right:300px;display:none">
        <label style="font-weight:500">跳转到</label>
       <input autocomplete = "off" value="1" id="pageNamber" class="form-control" style="width:40px;text-align:center;height:30px;display:inline-block" />
        <label style="font-weight:500">页</label>
    </div>
    @RenderPage("~/Views/Share/delConfirm.cshtml")
</body>
</html>
<script type="text/javascript">
    var SearchHeight = $(".mySearch").height();
    //console.log(SearchHeight);
    $('#ClueList_table').bootstrapTable({
        height: $(window).height() - SearchHeight-20,
        url: '/Clue/GetClueLinkList',
        method: 'get',
        toolbar: '#toolbar',    //工具按钮用哪个容器
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,     //是否显示分页（*）
        sortable: true,      //是否启用排序
        sortName: "ClueDate",
        sortOrder:"desc",
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 100,      //每页的记录行数（*）
        pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
        strictSearch: true,
        minimumCountColumns: 2,    //最少允许的列数
        clickToSelect: true,    //是否启用点击选中行
        queryParams: function (params) {
            return {
                sort: params.sortName,     //排序方式
                order: params.sortOrder,
                keyword1: $('#qry_ObjName').val(),
                keyword2: $('#qry_ObjAddress').val(),
                keyword3: $('#qry_ObjAdminLvl').val(),
                keyword4: $('#qry_MainMode').val(),
                keyword5: $('#qry_Status').val(),
                keyword6: $('#qry_HandleType').val(),
                keyword7: $('#start').val(),
                keyword8: $('#end').val(),
                buquan: $("#buquan").val(),
               // keyword9: $("input[type=checkbox]:checked").length <= 0 ? "" : $("input[type=checkbox]:checked").val(),
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
            }
        },
        columns: [
            { field: 'ClueDate', title: '登记时间', width: 50, editable: false, formatter: IfEmpty,sortable:true },
            { field: 'ObjName', title: '姓名', width: 50, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'ObjPost', title: '单位职务', width: 100, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'ObjAdminLvl', title: '行政级别', width: 50, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'Des', title: '主要内容', width: 150, editable: false, formatter: IfEmpty, sortable: true},
            //{ field: 'Status', title: '线索状态', width: 100, editable: false, },
            { field: 'opt', title: '操作', width: 90, editable: false, formatter: operateFormatterClue },
        ],
    });
    function operateFormatterClue(value, row, index) {
        return [
            '<button  onclick="LayerModal(\'编辑\',\'/Clue/Edit?ID=' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-sm" style="margin-right:10px">编辑</button>',
            '<a  href="javascript:deleteByID(\'' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="margin-right:10px">删除</a>',
        ].join('');
    }
    $('table').on('load-success.bs.table', function (data) {
        //console.log("load success");
        $("[data-toggle='tooltip']").tooltip();
        var a = $('table').bootstrapTable('getData');
        //console.log(a);
        if (a.length > 0) {
            $("#pageNamber1").css("display", "block");
        }
    });
    function waring(value, row, index) {
        var a = "";
        var oldTime = Date.parse(new Date(value));
        var nowTime = Date.parse(new Date());
        var xiangcha = Math.abs(parseInt((nowTime - oldTime) / 1000 / 3600 / 24));
        console.log("table");
        if (xiangcha > 40) {
            a = '<span style="color:#fff;background-color:#d46c6c;width:100%;height:100%;padding:5px" data-toggle="tooltip" data-placement="right" title="距今已有' + xiangcha + '天" >' + value + '</span>'
        } else {
            a = '<span data-toggle="tooltip" data-placement="right" title="距今已有' + xiangcha + '天" >' + value + '</span>'
        };
        return a;
    }
    function queryDataGrid() {
        $('#ClueList_table').bootstrapTable('refresh', {
            pageNumber: 1,
        });
    }
    function myClear() {
        $('#qry_ObjName').val("");
        $('#qry_ObjAddress').val("");
        $('#qry_ObjAdminLvl').val("");
        $('#qry_MainMode').val("");
        $('#qry_Status').val("");
        $('#qry_HandleType').val("");
        $('#start').val("");
        $('#end').val("");
        $('#ins1').val("");
        $('#IsEmpty').val("");
        queryDataGrid();
    };
    function Create() {
        LayerModal("新增", "/Clue/ClueLinkCreate");
    }

    function deleteByID(id) {
        $('#id').val(id);//给会话中的隐藏属性URL赋值
        $('#idName').val("ID");
        $('#backMsg').val("ClueList_table");
        $('#urlDel').val("/Clue/Delete");
        $('#urlBack').val("/Clue/GetClueLinkList");
        $('#delcfmModel').modal();
    }

    $(function () {
       // $('input[type=checkbox]').labelauty();
        $("#pageNamber").change(function () {
            $('table').bootstrapTable('refresh', {
                pageNumber: $("#pageNamber").val(),
            });
        })
    });
</script>
