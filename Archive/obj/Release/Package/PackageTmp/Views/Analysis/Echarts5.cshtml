@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AnalysisEcharts</title>
    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <script src="~/Resource/plugins/Echarts/echarts.js"></script>
    <script src="~/Resource/plugins/Echarts/echarts-gl.js"></script>
    <script src="~/Resource/plugins/Echarts/huaian.js"></script>
    <script src="~/Resource/plugins/Echarts/wonderland.js"></script>
</head>
<body>
    <div style="">
        <div class="container" style="width:100%;position:fixed;z-index:1000">
            <div class="row" style=" background-color: #fff">
                <div class="col-xs-12">
                    <h2 style="text-align: center;">党委党组运用第一种形态专题分析</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-1">
                    <button type="button" class="layui-btn" onclick="quanshi()">全市情况</button>
                </div>
                <div class="col-xs-1">
                    <label>起止时间</label>
                </div>
                <div class="col-xs-4">
                    <input placeholder="开始日期" value="2017-01" class="form-control layer-date" style="width:49% !important;display:inline-block" id="start2">
                    <input placeholder="结束日期" value="2017-06" class="form-control layer-date" style="width: 50% !important; display: inline-block; " id="end2">
                </div>
                <div class="col-xs-1">
                    <button class="layui-btn" style="margin-top:2px" type="button" onclick="mySreach()">查询</button>
                </div>
            </div>
        </div>
        <div style="width:45%;position:fixed;margin-top:50px">
            <div id="main" style="width: 100%;height:650px;float: left;display: inline-block;"></div>
        </div>

        <div style="width:54%;float:right;margin-top:120px">
            <div id="main2" style="width:100%;height:500px;float: left;display: inline-block;margin-bottom:30px;"></div>
            <div id="UseFirstForm" style="margin-top: 10px;width: 100%; height: 500px; float: left; display: inline-block; margin-bottom: 30px;"></div>
        </div>

    </div>
</body>
</html>
<script>
    function Appendzero(obj) {
        if (obj < 10) return "0" + obj; else return obj;
    }
    var myDate = new Date();
    var year = myDate.getFullYear();
    var month = myDate.getMonth() + 1;
    var now = Appendzero(year) + '-' + Appendzero(month);
    var now1 = Appendzero(year) + '-01'
    var start2 = laydate.render({
        elem: '#start2',
        type: 'month',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期

        value: now1,
    });
    var end2 = laydate.render({
        elem: '#end2',
        type: 'month',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期
        
        value: now,
    });
    mySreach();
    function mySreach() {
        GetMapData();
        quanshi();
    }
    function GetMapData() {
        $.ajax({
            url: "/Analysis/GetFirstFormMap",
            type: "post",
            dataType: "json",
            data: { HandleTime1: $("#start2").val(), HandleTime2: $("#end2").val(), },
            success: succFunction3,
            error: function () {
                console.log("失败了");
            }
        })
    }

    function succFunction3(data) {
        //console.log(data);
        var myData = "[" + data.substring(0, data.length - 1) + "]";
        // console.log(myData);
        myData = JSON.parse(myData);

        map(myData);
    }
    function map(myData) {
        var chart = echarts.init(document.getElementById('main'), 'wonderland');
        $.getJSON('/Resource/plugins/Echarts/json/jiangsu.json', function (data) {
            echarts.registerMap('huaian', data);

            chart.setOption({
                series: [{
                    type: 'map',
                    map: 'huaian',
                    data: myData,
                    selectedMode: 'single',

                    label: {
                        normal: {
                            show: true
                        },
                        emphasis: {
                            show: true,
                        }
                    },
                    itemStyle: {
                        shadowColor: 'rgba(0,0,0,0.8)',
                        shadowOffsetX: 10,
                        shadowOffsetY: 10,
                    }
                }],
                tooltip: {
                    formatter: function (params) {
                        return "第一种形态数:" + params.data.value2 + "<br/>占比：" + params.value+"%";
                    }
                },
                visualMap: {
                    min: 0,
                    max: 100,
                    left: 'left',
                    top: 'bottom',
                    text: ['多', '少'], // 文本，默认为数值文本
                    calculable: true,
                    color: [
                        "#c50000",
                        "#c8af59",
                        //"#aac859",
                        //"#88c859",
                        "#70c859",

                    ]
                },
            });
        });
        chart.on('click', function (params) {
            var city = params.data.id;
            info(city);
            info2(city);
        });
    }

    function quanshi() {
        var city = "全市";
        info(city);
        info2(city);
    };
    quanshi();
    //折现
    function info(name) {
        $.ajax({
            url: "/Analysis/GetFirstFormInfo",
            type: "post",
            dataType: "json",
            data: { HandleTime1: $("#start2").val(), HandleTime2: $("#end2").val(), PersonArea: name },
            success: succFunction4,
            error: function () {
                console.log("失败了");
            }
        })
        function succFunction4(data) {
            console.log(data);
            var Month = "";
            var myData = "";
            for (var i = 0; i < data.length; i++) {
                Month = Month + "\"" + data[i].CountDate + "\","
                myData = myData + "\"" + data[i].FirstFormTotal + "\","
            }
            Month = "[" + Month.substring(0, Month.length - 1) + "]";
            myData = "[" + myData.substring(0, myData.length - 1) + "]";
            //console.log(myData);
            Month = JSON.parse(Month);
            myData = JSON.parse(myData);
            axisChart(Month, myData);
        }
    }
    function axisChart(Month, myData) {
        var axisChart = echarts.init(document.getElementById('main2'), 'wonderland');
        var option4 = {
            title: {
                text: '第一种形态情况',
                x: 'center',
                padding: [0, 20, 20, 20]
            },
            tooltip: {
                trigger: 'axis'
            },
            toolbox: {
                show: true,
                right: 10,
                top: 30,
                feature: {
                    dataView: {
                        show: true,
                        readOnly: true
                    },
                    restore: {
                        show: true
                    },
                    saveAsImage: {
                        show: true
                    }
                }
            },
            grid: {
                containLabel: true
            },
            legend: {
                data: ['第一种形态情况'],

                top: 30,
            },
            xAxis: [{
                type: 'category',
                axisTick: {
                    alignWithLabel: true
                },
                axisLabel: { //坐标轴刻度标签的相关设置。
                    interval: 0,//横轴信息全部显示  
                    rotate: -30,//-30度角倾斜显示 
                },
                data: Month
            }],
            yAxis: [{
                type: 'value',
                name: '数量',
                position: 'left',
                axisLabel: {
                    formatter: '{value} '
                }
            }],
            series: [{
                name: '第一种形态情况',
                type: 'line',
                stack: '总量',
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                    }
                },
                lineStyle: {
                    normal: {
                        width: 3,
                        shadowColor: 'rgba(0,0,0,0.4)',
                        shadowBlur: 10,
                        shadowOffsetY: 10
                    }
                },
                data: myData,
            }]
        };
        axisChart.setOption(option4);
    }
    //饼图
    function info2(name) {
        $.ajax({
            url: "/Analysis/GetFirstFormType",
            type: "get",
            dataType: "json",
            data: { HandleTime1: $("#start2").val(), HandleTime2: $("#end2").val(), PersonArea: name },
            success: succFunctionUseFirstForm,
            error: function () {
                console.log("失败了");
            }
        })
        function succFunctionUseFirstForm(data) {
            //console.log(data);
            data = "[" + data.substring(0, data.length - 1) + "]";
            data = JSON.parse(data);
            //var myDataUseFirstForm = data;
            //console.log(myDataUseFirstForm);
            pieChart(data);
        }
    }
    function pieChart(myDataUseFirstForm) {
        var pieChart = echarts.init(document.getElementById('UseFirstForm'), 'wonderland');
        option3 = {
            title: {
                text: '运用第一种形态处理类别统计',
                subtext: '',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            toolbox: {
                right: 10,
                top: 30,
                feature: {
                    dataView: {
                        show: true,
                        readOnly: true
                    },
                    restore: {
                        show: true
                    },
                    saveAsImage: {
                        show: true
                    }
                }
            },
            legend: {
                x: 'center',
                y: 'bottom',
                data: ['提醒谈话', '诫勉谈话', '函询', '指定内容专题民主生活会说明情况', '通报批评'],
            },
            series: [
                {
                    name: '',
                    type: 'pie',
                    radius: ['0%', '60%'],
                    center: ['50%', '50%'],
                    data: myDataUseFirstForm,
                    label: {
                        normal: {
                            textStyle: {
                                fontWeight: 'normal',
                                fontSize: 16
                            }
                        }
                    },
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        pieChart.setOption(option3);

    }
</script>