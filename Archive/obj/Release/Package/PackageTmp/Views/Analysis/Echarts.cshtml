@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AnalysisEcharts</title>
    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <script src="~/Resource/plugins/Echarts/echarts.js"></script>
    <script src="~/Resource/plugins/Echarts/echarts-gl.js"></script>
    <script src="~/Resource/plugins/Echarts/huaian.js"></script>
    <script src="~/Resource/plugins/Echarts/wonderland.js"></script>
</head>
<body>
    <div style="">
        <div class="container" style="width:100%;position:fixed;z-index:1000">
            <div class="row" style=" background-color: #fff">
                <div class="col-xs-12">
                    <h2 style="text-align: center;">自办案件专题分析</h2>
                </div>
            </div>
        </div>
        <div class="row" style="">
            <div class="col-xs-1" style="margin-top: 70px;">
                <label>起止时间</label>
            </div>
            <div class="col-xs-4" style="margin-top: 70px;">
                <input placeholder="开始日期" value="" class="form-control layer-date" style="width:49% !important;display:inline-block" id="start2">
                <input placeholder="结束日期" value="" class="form-control layer-date" style="width: 50% !important; display: inline-block; " id="end2">
            </div>
            <div class="col-xs-1" style="margin-top: 70px;">
                <button class="layui-btn" style="margin-top:2px" type="button" onclick="mySreach()">查询</button>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6" style="margin-top:10px;">
                <div id="main5" style="width: 100%; height: 500px; float: left;  margin-bottom: 50px;"></div>
            </div>
            <div class="col-xs-6" style="margin-top:10px;">
                <div>
                    <h3 style="text-align: center; width: 100%; font-size: 18px; font-weight: 600; ">自办案件情况数据</h3>
                    <table id="ZiBan_table" style="">

                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    function Appendzero(obj) {
        if (obj < 10) return "0" + obj; else return obj;
    }
    var myDate = new Date();
    var year = myDate.getFullYear();
    var month = myDate.getMonth() + 1;
    var now1 = Appendzero(year) + '-01';
    var now = Appendzero(year) + '-' + Appendzero(month);
    var now = Appendzero(year) + '-' + Appendzero(month);
    var start2 = laydate.render({
        elem: '#start2',
        type: 'month',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期

        value: now1,
    });
    var end2 = laydate.render({
        elem: '#end2',
        type: 'month',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期
        
        value: now,
    });
    $("#start2").val(now1);
    $("#end2").val(now);
    $(function () {
        mySreach();
    })
    function mySreach() {
        console.log($("#start2").val());
        GetCaseOwn();
        $('#ZiBan_table').bootstrapTable('refresh', {
            pageNumber: 1,
        });
    }
    //柱状
    function GetCaseOwn() {
        $.ajax({
            url: "/Analysis/GetCaseOwn",
            type: "POST",
            dataType: "json",
            data: { Area: name, CountDate1: $("#start2").val(), CountDate2: $("#end2").val(),},
            success: function (data) {
                var myData = "[" + data.substring(0, data.length - 1) + "]";
                // console.log(myData);
                myData = JSON.parse(myData);
                //console.log(myData);
                var thisYear = "";
                var lastYear = "";
                var area = "";
                for (var i = 0; i < myData.length;i++){
                    thisYear = thisYear + myData[i].value1 + ",";
                    lastYear = lastYear + myData[i].value2 + ",";
                    area = area + "\""+myData[i].area + "\",";
                }
                thisYear = "[" + thisYear.substring(0, thisYear.length - 1) + "]";
                lastYear = "[" + lastYear.substring(0, lastYear.length - 1) + "]";
                area = "[" + area.substring(0, area.length - 1) + "]";
                // console.log(myData);
                //console.log(thisYear);
                thisYear = JSON.parse(thisYear);
                lastYear = JSON.parse(lastYear);
                area = JSON.parse(area);
                zibanChart(thisYear, lastYear, area);
            },
            error: function () {
                console.log("失败了");
            }
        })
    }
    function zibanChart(tihsYear, lastYear, area) {
        var zibanChart = echarts.init(document.getElementById('main5'), 'wonderland');
        option6 = {
            title: {
                x: 'center',
                top: 15,
                fontSize: 22,
                text: '自办案件情况',
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                },

            },
            legend: {
                bottom: 0,
                data: ['自办案件数', '去年同期自办案件数']
            },
            grid: {
                top: '10%',
                left: '3%',
                right: '4%',
                bottom: '9%',
                containLabel: true
            },
            xAxis: [
                {
                    axisLabel: { //坐标轴刻度标签的相关设置。
                        interval: 0,//横轴信息全部显示  
                        rotate: -30,//-30度角倾斜显示 
                    },
                    type: 'category',
                    axisTick: { show: true },
                    data: area,

                }
            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            series: [
                {
                    name: '自办案件数',
                    type: 'bar',
                    label: {
                        normal: {
                            show: true,
                            position: 'top'
                        }
                    },
                    barWidth: 20,//柱图宽度
                    data: tihsYear
                },
                {
                    name: '去年同期自办案件数',
                    type: 'bar',
                    stack: '比例',
                    label: {
                        normal: {
                            show: true,
                            position: 'top'
                        }
                    },
                    itemStyle: {
                        normal: { color: '#FF7F50' }
                    },
                    barWidth: 20,//柱图宽度
                    data: lastYear
                }
            ]
        };
        zibanChart.setOption(option6);
    }

    //
    $('#ZiBan_table').bootstrapTable({
        url: '/Analysis/GetCaseOwnTable',
        method: 'get',
        toolbar: '#toolbar',    //工具按钮用哪个容器
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: false,     //是否显示分页（*）
        sortable: false,      //是否启用排序
        sortOrder: "asc",     //排序方式
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 100,      //每页的记录行数（*）
        pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
        strictSearch: true,
        minimumCountColumns: 2,    //最少允许的列数
        clickToSelect: true,    //是否启用点击选中行
        queryParams: function (params) {
            return {
                HandleTime1: $('#start2').val(),
                HandleTime2: $('#end2').val(),
            }
        },
        columns: [
            { field: 'Area', title: '单位', width: 50, editable: false, },
            { field: 'CaseTotal', title: '案件总数', width: 50, editable: false, },
            { field: 'CaseOwnTotal', title: '自办案件数', width: 100, editable: false, },
            { field: 'Proportion', title: '自办案件占比', width: 50, editable: false, formatter: operateFormatter },
             { field: 'SameProportion', title: '自办案件同比', width: 50, editable: false, formatter: operateFormatter },
        ],
    });
    function operateFormatter(value, row, index) {
        return [
            '<span>'+ value +'%</span>'
        ].join('');
    }
</script>