@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AnalysisEcharts</title>
    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <script src="~/Resource/plugins/Echarts/echarts.js"></script>
    <script src="~/Resource/plugins/Echarts/echarts-gl.js"></script>
    <script src="~/Resource/plugins/Echarts/huaian.js"></script>
    <script src="~/Resource/plugins/Echarts/wonderland.js"></script>
</head>
<body>
    <div style="">
        <div class="container" style="width:100%;position:fixed;z-index:1000">
            <div class="row" style=" background-color: #fff">
                <div class="col-xs-12">
                    <h2 style="text-align: center;">纪律审查专题分析</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-2" style="padding:0px">
                    <button type="button" class="layui-btn" onclick="quanshi()">全省情况</button>
                    @*<button type="button" class="layui-btn" data-toggle="modal" data-target="#AllData">数据明细</button>*@
                    @*<button type="button" class="layui-btn" data-toggle="modal" data-target="#ScoringInstructions">评分说明</button>*@
                </div>
                <div class="col-xs-1">
                    <label>起止时间</label>
                </div>
                <div class="col-xs-4">
                    <input placeholder="开始日期" value="2017-01" class="form-control layer-date" style="width:49% !important;display:inline-block" id="start2">
                    <input placeholder="结束日期" value="2017-06" class="form-control layer-date" style="width: 50% !important; display: inline-block; " id="end2">
                </div>
                <div class="col-xs-1">
                    <button class="layui-btn" style="margin-top:2px" type="button" onclick="mySreach()">查询</button>
                </div>
            </div>
        </div>
        <div style="width:45%;position:fixed;margin-top:50px">
            <div id="main" style="width: 100%;height:650px;float: left;display: inline-block;"></div>
            <div style="position:fixed;top:580px;width:45%">
                @*<h3 style="text-align:center;position:relative">淮安市党员干部森林健康状况图</h3>*@
            </div>

        </div>

        <div style="width:54%;float:right;margin-top:120px">
            <div id="main2" style="width:100%;height:500px;float: left;display: inline-block;margin-bottom:30px;"></div>
            <div id="main3" style="width: 100%; height: 500px; float: left; display: inline-block; margin-bottom: 30px;"></div>
            <div id="main4" style="width: 100%; height: 500px; float: left; display: inline-block; margin-bottom: 50px;"></div>
        </div>
    </div>
    @*添加弹窗*@
    @*<div class="modal fade" id="AllData">
        <div class="modal-dialog" style="width:95%;height:600px">
            <div class="modal-content message_align">
                <div class="modal-header" style="padding:10px 15px">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title">详细数据</h4>
                </div>
                <div class="modal-body">
                    <table id="JILu_table" style="word-break:break-all; word-wrap:break-all;" class="table table-bordered table-hover table-striped"></table>
                </div>
                <div class="modal-footer" style="padding:10px 15px">
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" data-dismiss="modal">关闭</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>*@
    <div class="modal fade" id="ScoringInstructions">
        <div class="modal-dialog" style="width:50%;height:600px">
            <div class="modal-content message_align">
                <div class="modal-header" style="padding:10px 15px">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title">评分说明</h4>
                </div>
                <div class="modal-body">
                    <p style="text-indent: 2em;">以该地区党员总数为总分，每条问责情况扣2分，谈话函询情况扣2分，第二种形态扣10分，第三种形态扣50分，第四种形态扣100分；处理人为乡科级干部，扣除分加权2倍，县处级干部加权4倍；1减扣除分除以总分并换算为百分制，得出综合评分。</p>
                </div>
                <div class="modal-footer" style="padding:10px 15px">
                    <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" data-dismiss="modal">确定</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
</body>
</html>
<script type="text/javascript">
    //$('#ShenCha').bootstrapTable({});
 //   var myData = [
 //{ name: '淮安区', value: 488, id: "淮安区" },
 //{ name: '盱眙县', value: 276, id: "盱眙县" },
 //{ name: '洪泽区', value: 318, id: "洪泽区" },
 //{ name: '淮阴区', value: 367, id: "淮阴区" },
 //{ name: '金湖县', value: 309, id: "金湖县" },
 //{ name: '涟水县', value: 531, id: "涟水县" },
 //{ name: '清江浦区', value: 227, id: "清江浦区" },
    //   ]
    function Appendzero(obj) {
        if (obj < 10) return "0" + obj; else return obj;
    }
    var myDate = new Date();
    var year = myDate.getFullYear();
    var month = myDate.getMonth() + 1;
    var now = Appendzero(year) + '-' + Appendzero(month);
    var now1 = Appendzero(year) + '-01'
    var start2 = laydate.render({
        elem: '#start2',
        type: 'month',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期
        
        value: now1,
    });
    var end2 = laydate.render({
        elem: '#end2',
        type: 'month',
        //format: 'YYYY-MM',
        min: '1900-06-16 23:59:59', //设定最小日期为当前日期
        max: '2099-06-16 23:59:59', //最大日期
        
        value: now,
    });
    mySreach();
    function mySreach() {
        GetMapData();
        quanshi();
    }
    function GetMapData() {
        $.ajax({
            url: "/Analysis/GetClueTotalMap",
            type: "post",
            dataType: "json",
            data: { CountDate1: $("#start2").val(), CountDate2: $("#end2").val(), },
            success: succFunction3,
            error: function () {
                console.log("四种形态失败了");
            }
        })
    }
    
    function succFunction3(data) {
        //console.log(data);
        var myData = "[" + data.substring(0, data.length - 1) + "]";
        //console.log(myData);
        myData = JSON.parse(myData);
        
        map(myData);
    }

    function map(myData) {
        var chart = echarts.init(document.getElementById('main'), 'wonderland');
        $.getJSON('/Resource/plugins/Echarts/json/jiangsu.json', function (data) {
            echarts.registerMap('huaian', data);

            chart.setOption({
                series: [{
                    type: 'map',
                    map: 'huaian',
                    data: myData,
                    selectedMode: 'single',

                    label: {
                        normal: {
                            show: true
                        },
                        emphasis: {
                            show: true,
                        }
                    },
                    itemStyle: {
                        shadowColor: 'rgba(0,0,0,0.8)',
                        shadowOffsetX: 10,
                        shadowOffsetY: 10,
                    }
                }],
                tooltip: {
                    formatter: function (params) {
                        return "案件数量："+params.data.value2+"<br/>占全市案件总数：" + params.value+"%";
                    }
                },
                visualMap: {
                    min: 100,
                    max: 0,
                    left: 'left',
                    top: 'bottom',
                    text: ['占比(%)', ''], // 文本，默认为数值文本
                    calculable: true,
                    color: [
                        "#c50000",
                        "#c8af59",
                        "#aac859",
                        "#88c859",
                        "#70c859",
                    ]
                },
            });
        });
        chart.on('click', function (params) {
            var city = params.data.id;
            info(city);
            info2(city);
            info3(city);
        });
    }
    

    function quanshi() {
        var city = "全市";
        info(city);
        info2(city);
        info3(city);
    };
    quanshi();
    //折现
    function info(name) {
        $.ajax({
            //url: "/Json/Data3/Axis/" + name + ".json",
             url: "/Analysis/GetDisciplinaryReview",
            type: "POST",
            dataType: "json",
            data: { Area: name, CountDate1: $("#start2").val(), CountDate2: $("#end2").val(), },
            success: succFunction4,
            error: function () {
                console.log("失败了");
            }
        })
        function succFunction4(data) {
            var myDataFiling = "";
            var myDataClue = "";
            var myDate = "";
            //console.log(data.length);
            for (var i = 0; i < data.length; i++) {
                myDataFiling = myDataFiling + data[i].CaseTotal + ",";
                myDataClue = myDataClue + data[i].ClueTotal + ",";
                myDate = myDate +"\"" +data[i].CountDate + "\",";
            }
            myDataFiling = "[" + myDataFiling.substring(0, myDataFiling.length - 1) + "]";
            myDataClue = "[" + myDataClue.substring(0, myDataClue.length - 1) + "]";
            myDate = "[" + myDate.substring(0, myDate.length - 1) + "]";
            console.log(myDataClue);
            console.log(myDataFiling);
            myDataFiling = JSON.parse(myDataFiling);
            myDataClue = JSON.parse(myDataClue);
            myDate = JSON.parse(myDate);
            axisChart(myDataClue, myDataFiling, myDate);
        }
    }
    function axisChart(myDataClue, myDataFiling, myDate) {
        var axisChart = echarts.init(document.getElementById('main2'), 'wonderland');
        var option4 = {
            title: {
                text: '纪律审查情况',
                x: 'center',
                padding: [0, 20, 20, 20]
            },
            tooltip: {
                trigger: 'axis'
            },
            toolbox: {
                show: true,
                right: 10,
                top: 30,
                feature: {
                    dataView: {
                        show: true,
                        readOnly: true
                    },
                    restore: {
                        show: true
                    },
                    saveAsImage: {
                        show: true
                    }
                }
            },
            grid: {
                containLabel: true
            },
            legend: {
                data: ['立案', '问题线索'],

                top: 30,
            },
            xAxis: [{
                type: 'category',
                axisTick: {
                    alignWithLabel: true
                },
                axisLabel: { //坐标轴刻度标签的相关设置。
                    interval: 0,//横轴信息全部显示  
                    rotate: -30,//-30度角倾斜显示 
                },
                data: myDate
            }],
            yAxis: [{
                //type: 'value',
                name: '人数',
                position: 'left',
                //axisLabel: {
                //    formatter: '{value} '
                //}
            }],
            series: [{
                name: '问题线索',
                type: 'line',
                stack: '问题线索总量',
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                    }
                },
                lineStyle: {
                    normal: {
                        width: 3,
                        shadowColor: 'rgba(0,0,0,0.4)',
                        shadowBlur: 10,
                        shadowOffsetY: 10
                    }
                },
                data: myDataClue,
            }, {
                name: '立案',
                type: 'line',
                stack: '立案总量',
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                    }
                },
                lineStyle: {
                    normal: {
                        width: 3,
                        shadowColor: 'rgba(0,0,0,0.4)',
                        shadowBlur: 10,
                        shadowOffsetY: 10
                    }
                },
                data: myDataFiling,
            }]
        };
        axisChart.setOption(option4,true);
    }
    //饼图
    function info2(name) {
        $.ajax({
            url: "/Analysis/GetFourForm",
            type: "post",
            dataType: "json",
            data: {Area:name, CountDate1: $("#start2").val(), CountDate2: $("#end2").val(), },
            success: succFunction3,
            error: function () {
                console.log("四种形态失败了");
            }
        })
        function succFunction3(data) {
            data = "[" + data.substring(0, data.length - 1) + "]";
            data = JSON.parse(data);
           
            //console.log(myData3);
            pieChart(data);
        }
    }
    function pieChart(myData3) {
        var pieChart = echarts.init(document.getElementById('main3'), 'wonderland');
        option3 = {
            title: {
                text: '落实“四种形态”人数占比',
                subtext: '',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            toolbox: {
                right: 10,
                top: 30,
                feature: {
                    dataView: {
                        show: true,
                        readOnly: true
                    },
                    restore: {
                        show: true
                    },
                    saveAsImage: {
                        show: true
                    }
                }
            },
            legend: {
                x: 'center',
                y: 'bottom',
                data: ['第一种形态', '第二种形态', '第三种形态', '第四种形态'],
                //textStyle: {
                //    fontSize:16,
                //}
            },
            series: [
                {
                    name: '',
                    type: 'pie',
                    radius: ['0%', '60%'],
                    center: ['50%', '50%'],
                    data: myData3,
                    label: {
                        normal: {
                            textStyle: {
                                fontWeight: 'normal',
                                fontSize: 16
                            }
                        }
                    },
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        pieChart.setOption(option3);

    }
    //饼图
    function info3(name) {
        $.ajax({
            url: "/Analysis/GetSixDisciplines",
            type: "post",
            dataType: "json",
            data: { Area: name, CountDate1: $("#start2").val(), CountDate2: $("#end2").val()},
            success: succFunction4,
            error: function () {
                console.log("失败了");
            }
        })
        function succFunction4(data) {
            //console.log(data);
            data = "[" + data.substring(0, data.length - 1) + "]";
            data = JSON.parse(data);
            //console.log(myData4);
            pie2Chart(data);
        }
    }
    function pie2Chart(myData4) {
        var pie2Chart = echarts.init(document.getElementById('main4'), 'wonderland');
        option4 = {
            title: {
                text: '违反六大纪律占比',
                subtext: '',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            toolbox: {
                right: 10,
                top: 30,
                feature: {
                    dataView: {
                        show: true,
                        readOnly: true
                    },
                    restore: {
                        show: true
                    },
                    saveAsImage: {
                        show: true
                    }
                }
            },
            legend: {
                x: 'center',
                y: 'bottom',
                data: ['违反政治纪律', '违反廉洁纪律', '违反群众纪律', '违反工作纪律', '违反组织纪律', '违反生活纪律'],
            },
            series: [
                {
                    name: '',
                    type: 'pie',
                    radius: ['0%', '60%'],
                    center: ['50%', '50%'],
                    data: myData4,
                    label: {
                        normal: {
                            textStyle: {
                                fontWeight: 'normal',
                                fontSize: 16
                            }
                        }
                    },
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        pie2Chart.setOption(option4);

    }

    //表格
    //var JILuurl = '/Json/jilvshenchabiaoge.json';
    //$('#JILu_table').bootstrapTable({
    //    method: 'get',
    //    url: JILuurl,
    //    title: "全市纪律审查情况一览表",
    //    striped: true,
    //    clickToSelect: true,
    //    pageSize: 10,
    //    sidePagination: 'server',
    //    pageList: [10, 20, 50, 100, 200, 500],
    //    queryParamsType: 'limit',
    //    columns: [
    //        [
    //        { field: 'WorkUnit', title: '区域单位', editable: false, colspan: 1, rowspan: 3 },
    //        { title: '线索', editable: false, colspan: 2, rowspan: 1 },
    //        { title: '立案', editable: false, colspan: 11, rowspan: 1 },
    //        { title: '结案', editable: false, colspan: 4, rowspan: 1 },
    //        { field: 'NumberOne', title: '一把手', editable: false, colspan: 1, rowspan: 3 },
    //        { field: 'Organization', title: '组织处理', editable: false, colspan: 1, rowspan: 3 },
    //        { field: 'Transfer', title: '移送司法', editable: false, colspan: 1, rowspan: 3 }
    //        ]
    //        , [
    //        { field: 'Sums', title: '总数', editable: false, width: 100, colspan: 1, rowspan: 2 },
    //        { field: 'Talk', title: '谈话函询', editable: false, width: 100, colspan: 1, rowspan: 2 },

    //        { title: '总数', editable: false, colspan: 3, rowspan: 1 },
    //        { title: '自办案件', editable: false, colspan: 2, rowspan: 1 },
    //        { title: '县处级', editable: false, colspan: 3, rowspan: 1 },
    //        { title: '乡科级', editable: false, colspan: 3, rowspan: 1 },

    //        { field: 'Sums2', title: '总数', editable: false, width: 100, colspan: 1, rowspan: 2 },
    //        { field: 'Punishment', title: '处分人数', editable: false, width: 100, colspan: 1, rowspan: 2 },
    //        { field: 'Party', title: '党纪', editable: false, width: 100, colspan: 1, rowspan: 2 },
    //        { field: 'Government', title: '政纪', editable: false, width: 100, colspan: 1, rowspan: 2 },
    //        ], [
    //        { field: 'ThisYear', title: '今年', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'LastYear', title: '去年', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'Increase', title: '增幅', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'Sums3', title: '总数', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'Proportion', title: '占比', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'ThisYear2', title: '今年', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'LastYear2', title: '去年', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'Increase2', title: '增幅', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'ThisYear3', title: '今年', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'LastYear3', title: '去年', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        { field: 'Increase3', title: '增幅', editable: false, width: 100, colspan: 1, rowspan: 1 },
    //        ]
    //    ]
    //})
</script>