@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>

    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <link href="~/Resource/plugins/radio/css/jquery-labelauty.css" rel="stylesheet" />
    <script src="~/Resource/plugins/radio/js/jquery-labelauty.js"></script>
    <style>
        li {
            list-style: none;
        }

        .labelauty-checked, .labelauty-unchecked {
            font-size: 12px !important;
        }

        .dowebok li label {
            padding: 5px 10px !important;
        }
    </style>
</head>
<body>
    <div class="mySearch">
        <div class="row">
            <div class="col-xs-1">
                <label class="">被实施者：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" type="text" name="PersonName" id="qry_PersonName" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label class="">所在单位：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonUnit" id="qry_PersonUnit">
            </div>
            <div class="col-xs-1">
                <label class="">职级：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonLevel" id="qry_PersonLevel">
            </div>
            <div class="col-xs-1">
                <label class="">地区或部门：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonArea" id="qry_PersonArea">
            </div>
        </div>
        <div class="row margin-top-10">
            <div class="col-xs-1">
                <label class="">实施机关：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="HandleUnit" id="qry_HandleUnit">
            </div>
            <div class="col-xs-1">
                <label class="">实施方式：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="FirstFormType" id="qry_FirstFormType">
            </div>
            <div class="col-xs-1">
                <label class="">实施时间：</label>
            </div>
            <div class="col-xs-5">
                   <input autocomplete = "off" placeholder="起止日期" class="form-control layer-date" style="width:100% !important;display:inline-block" id="ins1">
            </div>
        </div>
        <div class="row margin-top-10">
            <div class="col-xs-1">
                <label class="">数据补全：</label>
            </div>
            <div class="col-xs-2">
                <select id="buquan" class="form-control selectpicker">
                    <option value=""></option>
                    <option value="未完善信息">未完善信息</option>
                    <option value="未关联干部">未关联干部</option>
                    <option value="未上传附件">未上传附件</option>
                    <option value="已上传附件">已上传附件</option>
                </select>
            </div>

            <div class="col-xs-6">
        
                <div class="inline-b" style=" margin:0px 10px 0px 10px;position:relative;float:left;width:80px">
                   <input autocomplete = "off" id="file_upload" name="file_upload" type="file" multiple="true" />
                </div>
                <div class="inline-b" style="position: relative; float: left; margin-left: 20px; margin: 0px 0px 0px 10px;">
                    <a class="layui-btn" id="btnUpload" data-options="iconCls:'icon-save'" href="javascript:checkQueue()">导入</a>
                    <a class="layui-btn layui-btn-primary" id="btnCancelUpload" data-options="iconCls:'icon-cancel'" href="javascript:checkCancel()">取消</a>
                </div>
                <div id="queue" style="margin-top: 0px 0px 0px 10px; width: 50%; position: relative; display: inline-block; float: left; margin-left: 20px;"></div>
            </div>
            <div class="col-xs-3" style="text-align:right">
                <button type="button" class="layui-btn" onclick="Create()"><i class="layui-icon"></i></button>

                <button class="layui-btn layuiadmin-btn-list" onclick="queryDataGrid()">
                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                </button>
                <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="myClear()">
                    <i class="layui-icon layui-icon-refresh-1 layuiadmin-button-btn"></i>
                </button>
               <input autocomplete = "off" type="checkbox" class="form-control" value="false" data-labelauty="日期格式错误" onclick="queryDataGrid()" />
            </div>
        </div>
       
    </div>


    <div>
        <table id="FirstFormList_table" class="table table-striped table-no-bordered table-hover" ></table>
    </div>
    <div id="pageNamber1" style="position:absolute;bottom:14px;text-align:center;right:300px;display:none">
        <label style="font-weight:500">跳转到</label>
       <input autocomplete = "off" value="1" id="pageNamber" class="form-control" style="width:40px;text-align:center;height:30px;display:inline-block" />
        <label style="font-weight:500">页</label>
    </div>
    @RenderPage("~/Views/Share/delConfirm.cshtml")
    <div id="myMasks">
        <div id="ai" style="position: relative; border-radius: 10px; width: 250px; height: 100px; margin-left: auto; margin-right: auto; margin-top: 10px; background-color: rgba(0,0,0,0.4); padding: 20px; }">
            <div id="foo" style="float: left; width: auto; height: auto; margin-top: 12px; margin-top: 28px; margin-left: 25px; "></div>
            <label id="myMasksText" style="color: #fff; font-size: 18px; float: left; margin-left: 40px;  margin-top: 15px; ">正在导入，请稍等</label>
        </div>
    </div>
    
</body>
</html>
<script type="text/javascript">
    var SearchHeight = $(".mySearch").height();
    console.log(SearchHeight);
    $('#FirstFormList_table').bootstrapTable({
        height: $(window).height() - SearchHeight+19,
        url: '/FirstForm/GetFirstFormList',
        method: 'get',
        toolbar: '#toolbar',    //工具按钮用哪个容器
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,     //是否显示分页（*）
        sortable: true,      //是否启用排序
        sortName: "HandleTime",
        sortOrder: "desc",
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 100,      //每页的记录行数（*）
        pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        // 设置为 ''  在这种情况下传给服务器的参数为：pageSize,pageNumber

        //queryParams: queryParams,//前端调用服务时，会默认传递上边提到的参数，如果需要添加自定义参数，可以自定义一个函数返回请求参数
        sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
        //search: true,      //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
        strictSearch: true,
        //showColumns: true,     //是否显示所有的列
        //showRefresh: true,     //是否显示刷新按钮
        minimumCountColumns: 2,    //最少允许的列数
        clickToSelect: true,    //是否启用点击选中行
        queryParams: function (params) {

            return {
                sort: params.sortName,     //排序方式
                order: params.sortOrder,
                keyword1: $('#qry_PersonName').val(),
                keyword2: $('#qry_PersonUnit').val(),
                keyword3: $('#qry_PersonLevel').val(),
                keyword4: $('#qry_PersonArea').val(),
                keyword5: $('#qry_HandleUnit').val(),
                keyword6: $('#qry_FirstFormType').val(),
                keyword7: $('#start').val(),
                keyword8: $('#end').val(),
                buquan: $("#buquan").val(),
                DateFormat: $("input[type=checkbox]:checked").val(),
                //keyword9: $("input[type=checkbox]:checked").length <= 0 ? "" : $("input[type=checkbox]:checked").val(),
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
            }
        },
        columns: [
            { field: 'HandleTime', title: '实施时间', width: 50, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'PersonArea', title: '地区或部门', width: 50, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'HandleUnit', title: '实施机关', width: 100, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'FirstFormType', title: '实施方式', width: 100, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'PersonName', title: '被实施者', width: 50, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'PersonUnit', title: '所在单位', width: 100, editable: false, formatter: IfEmpty, sortable: true },
            { field: 'PersonLevel', title: '职级', width: 50, editable: false, formatter: IfEmpty, sortable: true},
            { field: 'opt', title: '操作', width: 90, editable: false, formatter: operateFormatterFirstForm },
        ],
    });
    $('table').on('load-success.bs.table', function (data) {
        console.log("load success");
        $("[data-toggle='tooltip']").tooltip();
        var a = $('table').bootstrapTable('getData');
        //console.log(a);
        if (a.length > 0) {
            $("#pageNamber1").css("display", "block");
        }
    });
    function operateFormatterFirstForm(value, row, index) {
        return [
            '<button  onclick="LayerModal(\'编辑\',\'/FirstForm/Edit?ID=' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-sm" style="margin-right:10px">编辑</button>',
            '<a  href="javascript:deleteByID(\'' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="margin-right:10px">删除</a>',
        ].join('');
    }
    $(function () {
        $('input[type=checkbox]').labelauty();
        $("#pageNamber").change(function () {
            $('table').bootstrapTable('refresh', {
                pageNumber: $("#pageNamber").val(),
            });
        })
    });
    
    function queryDataGrid() {
        console.log($("input[type=checkbox]:checked").val());
        $('#FirstFormList_table').bootstrapTable('refresh', {
            pageNumber: 1,
        });
    }
    function myClear() {
        $('#qry_PersonName').val("");
        $('#qry_PersonUnit').val("");
        $('#qry_PersonLevel').val("");
        $('#qry_PersonArea').val("");
        $('#qry_HandleUnit').val("");
        $('#qry_FirstFormType').val("");
        $('#start').val("");
        $('#end').val("");
        $('#ins1').val("");
        $('#IsEmpty').val("");
        $("#buquan").val("");
        $("#buquan").selectpicker("refresh");
        queryDataGrid();
    };
    function Create() {
        LayerModal("新增", "/FirstForm/FirstFormCreate");

    }

    function checkQueue() {
        if ($("#queue").children().length == 0) {
            alert("请先点击浏览选择要上传的文件！");
        } else {
            loading();
           $('#file_upload').uploadifive('upload');
        }
    }
    function checkCancel() {
        if ($("#queue").children().length == 0) {
            alert("没有待上传的文件！");
        } else {
            
            $('#file_upload').uploadifive('clearQueue');
            queryDataGrid();
        }
    }

    $(function () {
        var a = 0;
        $('#file_upload').uploadifive({
            'auto': false,
            'fileSizeLimit': '102400KB',
            'buttonText': '浏  览',
            'multi': true,
            'queueID': 'queue',
            'uploadScript': '/FirstForm/FirstFormUpload',
            'formData': { 'ID': '@*@item.ID*@', 'type': 'FirstForm' },
            'onUploadComplete': function (file, data) {
                a = a + 1;
                if ($("#queue").children().length - a == 0) {
                    checkCancel();
                    a = 0;
                }
                unload();
            }
        });
    });

    function deleteByID(id) {
        $('#id').val(id);//给会话中的隐藏属性URL赋值
        $('#idName').val("ID");
        $('#backMsg').val("FirstFormList_table");
        $('#urlDel').val("/FirstForm/Delete");
        $('#urlBack').val("/FirstForm/GetFirstFormList");
        $('#delcfmModel').modal();
    }

    var spinner;
    function loading() {
        $("#myMasksText").html("正在导入，请稍等");
        $("#myMasks").fadeIn(300);
        var height = $(window).height() + "px";
        $("#myMasks").height($(window).height());
        //
        $("#ai").css("top", $(window).height() / 2 - 100);
        var opts = {
            lines: 13, //The number of lines to draw   菊花瓣的数目
            length: 7, //The length of each line   菊花瓣的长度
            width: 4, //The line thickness   菊花瓣的宽度
            radius: 10, //The radius of the inner circle   菊花中心的半径
            corners: 1, //Corner roundness (0..1)   菊花瓣的圆滑度(0--1)
            rotate: 0, //The rotation offset   让菊花旋转的角度
            color: '#fff', //#rgb or #rrggbb   菊花的颜色
            speed: 1, //Rounds per second   菊花旋转的速度
            trail: 60, //Afterglow percentage   菊花旋转时的余辉
            shadow: false, //Whether to render a shadow   是否需要菊花的阴影
            hwaccel: false, //Whether to use hardware acceleration   是否需要菊花高速旋转(硬件加速)
            className: 'spinner', //The CSS class to assign to the spinner   菊花的classname
            zIndex: 2e9, //The z-index (defaults to 2000000000)   菊花的z-index值
            top: 'auto', //Top position relative to parent in px   菊花相对定位的top
            left: 'auto' //Left position relative to parent in px  菊花相对定位的left
        };
        var target = document.getElementById('foo');
        spinner = new Spinner(opts).spin(target);
    }
    function unload() {
        spinner.stop();
        $("#myMasksText").html("导入成功");
        setTimeout(function () {
            $("#myMasks").fadeOut(300);
        }, 500);
    }
 
</script>