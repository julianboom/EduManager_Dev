@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>

    @RenderPage("~/Views/Share/bootstrap.cshtml")
    <link href="~/Resource/plugins/radio/css/jquery-labelauty.css" rel="stylesheet" />
    <script src="~/Resource/plugins/radio/js/jquery-labelauty.js"></script>
    <style>
        li {
            list-style: none;
        }

        .labelauty-checked, .labelauty-unchecked {
            font-size: 12px !important;
        }

        .dowebok li label {
            padding: 5px 10px !important;
        }
    </style>
</head>
<body>
    <div class="mySearch">
        <div class="row">
            <div class="col-xs-1">
                <label class="">被反映人姓名：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" type="text" name="PersonName" id="qry_PersonName" class="form-control" />
            </div>
            <div class="col-xs-1">
                <label class="">工作单位：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonUnit" id="qry_PersonUnit">
            </div>
            <div class="col-xs-1">
                <label class="">职级：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonLevel" id="qry_PersonLevel">
            </div>
            <div class="col-xs-1">
                <label class="">地区或部门：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="PersonArea" id="qry_PersonArea">
            </div>
        </div>
        <div class="row margin-top-10">
            <div class="col-xs-1">
                <label class="">实施机关：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="HandleUnit" id="qry_HandleUnit">
            </div>
            <div class="col-xs-1">
                <label class="">实施方式：</label>
            </div>
            <div class="col-xs-2">
               <input autocomplete = "off" class="form-control" name="TalkQueryType" id="qry_TalkQueryType">
            </div>
            <div class="col-xs-1">
                <label class="">实施时间：</label>
            </div>
            <div class="col-xs-2">
                   <input autocomplete = "off" placeholder="起止日期" class="form-control layer-date" style="width:100% !important;display:inline-block" id="ins1">
            </div>
            <div class="col-xs-1">
                <label class="">数据补全：</label>
            </div>
            <div class="col-xs-2">
                <select id="buquan" class="form-control selectpicker">
                    <option value=""></option>
                    <option value="未完善信息">未完善信息</option>
                    <option value="未关联干部">未关联干部</option>
                    <option value="未上传附件">未上传附件</option>
                    <option value="已上传附件">已上传附件</option>
                </select>
            </div>
        </div>
       
        <div class="row margin-top-10">
            <div class="col-xs-9">
                <div style=" margin:0px 0px 10px 0px;position:relative;float:left;">
                    <button type="button" class="layui-btn" onclick="Edit('')"><i class="layui-icon"></i></button>

                </div>
            </div>
            <div class="col-xs-3" style="text-align:right">
                

                <button class="layui-btn layuiadmin-btn-list" onclick="queryDataGrid()">
                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                </button>
                <button class="layui-btn layui-btn-primary layuiadmin-btn-list" onclick="myClear()">
                    <i class="layui-icon layui-icon-refresh-1 layuiadmin-button-btn"></i>
                </button>
               <input autocomplete = "off" type="checkbox" class="form-control" value="false" data-labelauty="日期格式错误" onclick="queryDataGrid()" />

            </div>
        </div>
    </div>
    <div class="modal fade" id="diejia" style="border-radius:10px;padding-left:80px;padding-right:80px;padding-top:20px">

            <button style="position: fixed; right: 0px;width: 50px;height: 50px;z-index:10;border-radius: 50%;background-color: #ffffff;color: #000000;" type="button" class="close" onclick="myclose()">
                <span aria-hidden="true" style="font-size:26px">×</span>
            </button>
            <iframe id="diejiayemian" style="border:none;margin:0 auto;padding:0 80px;border-radius:10px" width="100%" height="90%" src=""></iframe>

    </div>


    <div>
        <table id="TalkQueryList_table" class="table table-striped table-no-bordered table-hover" ></table>
    </div>
    <div id="pageNamber1" style="position:absolute;bottom:24px;text-align:center;right:300px;display:none">
        <label style="font-weight:500">跳转到</label>
       <input autocomplete = "off" value="1" id="pageNamber" class="form-control" style="width:40px;text-align:center;height:30px;display:inline-block" />
        <label style="font-weight:500">页</label>
    </div>
    @RenderPage("~/Views/Share/delConfirm.cshtml")
 
    
</body>
</html>
<script type="text/javascript">
    function myclose() {
        $("#diejia").modal('hide');
        $("#diejiayemian").attr("src", "");
        queryDataGrid();
    }

    function Edit(ID) {
  
        var src = "";
        if (ID != "") {
            src = '/TalkQuery/Edit?ID=' + ID + '&Type=Edit';
            LayerModal("编辑",src);

        } else {
            src = '/TalkQuery/TalkQueryCreate';
            LayerModal("新增", src);

        }

        //$("#diejiayemian").attr("src", src);
    }
    var SearchHeight = $(".mySearch").height();
    console.log(SearchHeight);
    $('#TalkQueryList_table').bootstrapTable({
        height: $(window).height() - SearchHeight,
        url: '/TalkQuery/GetTalkQueryList',
        method: 'get',
        toolbar: '#toolbar',    //工具按钮用哪个容器
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,     //是否显示分页（*）
        sortable: true,      //是否启用排序
        sortName: "HandleDate",
        sortOrder: "desc",
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 100,      //每页的记录行数（*）
        pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        // 设置为 ''  在这种情况下传给服务器的参数为：pageSize,pageNumber

        //queryParams: queryParams,//前端调用服务时，会默认传递上边提到的参数，如果需要添加自定义参数，可以自定义一个函数返回请求参数
        sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
        //search: true,      //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
        strictSearch: true,
        //showColumns: true,     //是否显示所有的列
        //showRefresh: true,     //是否显示刷新按钮
        minimumCountColumns: 2,    //最少允许的列数
        clickToSelect: true,    //是否启用点击选中行
        queryParams: function (params) {

            return {
                sort: params.sortName,     //排序方式
                order: params.sortOrder,
                keyword1: $('#qry_PersonName').val(),
                keyword2: $('#qry_PersonUnit').val(),
                keyword3: $('#qry_PersonLevel').val(),
                keyword4: $('#qry_PersonArea').val(),
                keyword5: $('#qry_HandleUnit').val(),
                keyword6: $('#qry_TalkQueryType').val(),
                keyword7: $('#start').val(),
                keyword8: $('#end').val(),
                buquan: $("#buquan").val(),
                DateFormat: $("input[type=checkbox]:checked").val(),
                //keyword9: $("input[type=checkbox]:checked").length <= 0 ? "" : $("input[type=checkbox]:checked").val(),
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
            }
        },
        columns: [

            { field: 'PersonName', title: '被反映人姓名', width: 50, editable: false, formatter: IfEmpty, sortable: true  },
            { field: 'IDCard', title: '身份证号', width: 100, editable: false, formatter: IfEmpty, sortable: true  },

            { field: 'PersonUnit', title: '工作单位', width: 100, editable: false, formatter: IfEmpty, sortable: true  },

            { field: 'PersonDuty', title: '职务', width: 100, editable: false, formatter: IfEmpty, sortable: true  },
            { field: 'PersonLevel', title: '职级', width: 50, editable: false, formatter: IfEmpty, sortable: true  },

            { field: 'ReceiveDate', title: '收到日期', width: 100, editable: false, formatter: IfEmpty, sortable: true  },

            { field: 'opt', title: '操作', width: 90, editable: false, formatter: operateFormatterTalkQuery },
        ],
    });
    $('table').on('load-success.bs.table', function (data) {
        console.log("load success");
        $("[data-toggle='tooltip']").tooltip();
        var a = $('table').bootstrapTable('getData');
        //console.log(a);
        if (a.length > 0) {
            $("#pageNamber1").css("display", "block");
        }
    });
    function operateFormatterTalkQuery(value, row, index) {
        return [
            '<a  href="javascript:Edit(\'' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn  layui-btn-sm" style="margin-right:10px">编辑</a>',
            '<a  href="javascript:deleteByID(\'' + row.ID + '\')" id="btn_detail" type="button" class="layui-btn layui-btn-danger layui-btn-sm" style="margin-right:10px">删除</a>',
        ].join('');
    }
    $(function () {
        $('input[type=checkbox]').labelauty();
        $("#pageNamber").change(function () {
            $('table').bootstrapTable('refresh', {
                pageNumber: $("#pageNamber").val(),
            });
        })
    });
    
    function queryDataGrid() {
        console.log($("input[type=checkbox]:checked").val());
        $('#TalkQueryList_table').bootstrapTable('refresh', {
            pageNumber: 1,
        });
    }
    function myClear() {
        $('#qry_PersonName').val("");
        $('#qry_PersonUnit').val("");
        $('#qry_PersonLevel').val("");
        $('#qry_PersonArea').val("");
        $('#qry_HandleUnit').val("");
        $('#qry_TalkQueryType').val("");
        $('#start').val("");
        $('#end').val("");
        $('#ins1').val("");
        $('#IsEmpty').val("");
        $("#buquan").val("");
        $("#buquan").selectpicker("refresh");
        queryDataGrid();
    };
    function Create() {

        LayerModal("新增", "/TalkQuery/TalkQueryCreate");

    }

    function checkQueue() {
        if ($("#queue").children().length == 0) {
            alert("请先点击浏览选择要上传的文件！");
        } else {
            loading();
           $('#file_upload').uploadifive('upload');
        }
    }
    function checkCancel() {
        if ($("#queue").children().length == 0) {
            alert("没有待上传的文件！");
        } else {
            
            $('#file_upload').uploadifive('clearQueue');
            queryDataGrid();
        }
    }

    function deleteByID(id) {
        $('#id').val(id);//给会话中的隐藏属性URL赋值
        $('#idName').val("ID");
        $('#backMsg').val("TalkQueryList_table");
        $('#urlDel').val("/TalkQuery/Delete");
        $('#urlBack').val("/TalkQuery/GetTalkQueryList");
        $('#delcfmModel').modal();
    }

    var spinner;
 
 
</script>